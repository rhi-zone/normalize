{
  "openapi": "3.1.0",
  "info": {
    "title": "Normalize API",
    "description": "Code intelligence API for normalize",
    "license": {
      "name": "MIT",
      "identifier": "MIT"
    },
    "version": "0.1.0"
  },
  "paths": {
    "/files": {
      "get": {
        "tags": [
          "files"
        ],
        "summary": "List indexed files",
        "operationId": "list_files",
        "parameters": [
          {
            "name": "pattern",
            "in": "query",
            "description": "Glob pattern to filter files",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of files",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/files/{path}": {
      "get": {
        "tags": [
          "files"
        ],
        "summary": "Get file information and symbols",
        "operationId": "get_file",
        "parameters": [
          {
            "name": "path",
            "in": "path",
            "description": "File path relative to root",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "File info with symbols",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileInfoResponse"
                }
              }
            }
          },
          "404": {
            "description": "File not found"
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "health"
        ],
        "summary": "Check server health",
        "operationId": "health",
        "responses": {
          "200": {
            "description": "Server is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/search": {
      "get": {
        "tags": [
          "search"
        ],
        "summary": "Search files and symbols",
        "operationId": "search",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Search query string",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Search type: \"file\", \"symbol\", or \"all\"",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SearchResponse"
                }
              }
            }
          }
        }
      }
    },
    "/symbols": {
      "get": {
        "tags": [
          "symbols"
        ],
        "summary": "List symbols from index",
        "operationId": "list_symbols",
        "parameters": [
          {
            "name": "name",
            "in": "query",
            "description": "Symbol name pattern",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "kind",
            "in": "query",
            "description": "Filter by kind (function, class, etc.)",
            "required": false,
            "schema": {
              "type": [
                "string",
                "null"
              ]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results",
            "required": false,
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of symbols",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SymbolListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/symbols/{name}": {
      "get": {
        "tags": [
          "symbols"
        ],
        "summary": "Get symbol details and source code",
        "operationId": "get_symbol",
        "parameters": [
          {
            "name": "name",
            "in": "path",
            "description": "Symbol name",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Symbol details with source",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SymbolDetailResponse"
                }
              }
            }
          },
          "404": {
            "description": "Symbol not found"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "FileInfoResponse": {
        "type": "object",
        "description": "File info response.",
        "required": [
          "path",
          "symbols"
        ],
        "properties": {
          "path": {
            "type": "string",
            "description": "File path"
          },
          "symbols": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SymbolInfo"
            },
            "description": "Symbols defined in the file"
          }
        }
      },
      "FileListResponse": {
        "type": "object",
        "description": "File list response.",
        "required": [
          "files"
        ],
        "properties": {
          "files": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of file paths"
          }
        }
      },
      "HealthResponse": {
        "type": "object",
        "description": "Health check response.",
        "required": [
          "status",
          "files_indexed"
        ],
        "properties": {
          "files_indexed": {
            "type": "integer",
            "description": "Number of files in the index",
            "minimum": 0
          },
          "status": {
            "type": "string",
            "description": "Server status"
          }
        }
      },
      "IndexedSymbol": {
        "type": "object",
        "description": "Indexed symbol info",
        "required": [
          "name",
          "kind",
          "file",
          "line"
        ],
        "properties": {
          "file": {
            "type": "string",
            "description": "File containing the symbol"
          },
          "kind": {
            "type": "string",
            "description": "Symbol kind"
          },
          "line": {
            "type": "integer",
            "description": "Line number",
            "minimum": 0
          },
          "name": {
            "type": "string",
            "description": "Symbol name"
          }
        }
      },
      "SearchResponse": {
        "type": "object",
        "description": "Search response.",
        "required": [
          "results"
        ],
        "properties": {
          "results": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SearchResult"
            },
            "description": "Search results"
          }
        }
      },
      "SearchResult": {
        "type": "object",
        "description": "Individual search result",
        "required": [
          "path",
          "kind"
        ],
        "properties": {
          "kind": {
            "type": "string",
            "description": "Result kind (file or symbol kind)"
          },
          "line": {
            "type": [
              "integer",
              "null"
            ],
            "description": "Line number (if symbol result)",
            "minimum": 0
          },
          "name": {
            "type": [
              "string",
              "null"
            ],
            "description": "Symbol name (if symbol result)"
          },
          "path": {
            "type": "string",
            "description": "File path"
          }
        }
      },
      "SymbolDetailResponse": {
        "type": "object",
        "description": "Symbol detail response",
        "required": [
          "name",
          "file",
          "start_line",
          "end_line",
          "source"
        ],
        "properties": {
          "end_line": {
            "type": "integer",
            "description": "End line",
            "minimum": 0
          },
          "file": {
            "type": "string",
            "description": "File containing the symbol"
          },
          "name": {
            "type": "string",
            "description": "Symbol name"
          },
          "source": {
            "type": "string",
            "description": "Source code"
          },
          "start_line": {
            "type": "integer",
            "description": "Start line",
            "minimum": 0
          }
        }
      },
      "SymbolInfo": {
        "type": "object",
        "description": "Symbol info for file response.",
        "required": [
          "name",
          "kind",
          "line"
        ],
        "properties": {
          "kind": {
            "type": "string",
            "description": "Symbol kind (function, class, etc.)"
          },
          "line": {
            "type": "integer",
            "description": "Line number",
            "minimum": 0
          },
          "name": {
            "type": "string",
            "description": "Symbol name"
          }
        }
      },
      "SymbolListResponse": {
        "type": "object",
        "description": "Symbol search response.",
        "required": [
          "symbols"
        ],
        "properties": {
          "symbols": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/IndexedSymbol"
            },
            "description": "List of matching symbols"
          }
        }
      }
    }
  }
}
